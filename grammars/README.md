# Grammars

## Structure

The `base` directory contains some IRTG grammars from the original [SLOG](https://github.com/bingzhilee/slog) repository. Some slight modifications have been added, which are mentioned in comments in the non-preprocessed files.

From these base grammars, we generate one general grammar that allows for valid parses on sentences with the linguistic properties we desire, i.e., prepositional phrases, relative clauses, and so on.

Furthermore, each of the six sentence types generated by this repository has its own separate grammar. Each grammar is meant to consist of a minimal amount of rules such that it only runs a valid parse on sentences following its specifications. This is used in the evaluation step in order to determine which sentences have been correctly generated and which sets to keep or to discard.

## Grammar Pipeline

The `combine_grammars.py` script is a helper script that was used to combine the main and relative clause grammars from SLOG into a single IRTG file.

The `cogs-preprocess.py` script is adapted from SLOG and is used in conjunction with `specify_grammar.irtg` in order to dynamically render the final grammar from the "base" IRTG files. The naming convention for the outputs of this script is usually to prepend `preprocessed-` to the grammar name to avoid confusion.

For example, if we make modifications to our base grammar (`combined-grammars.irtg`), we must first `include` it in `specify_grammar.irtg`:

```bash
{% set cnt = counter(1) %}

interpretation english: de.up.ling.irtg.algebra.StringAlgebra
interpretation semantics: de.saar.coli.algebra.OrderedFeatureTreeAlgebra


{% include 'lexicon.irtg' %}
{% include 'combined-grammars.irtg' %}
```

Then use the preprocess script to render the contents:

```bash
$ python3 cogs-preprocess.py specify_grammar.irtg > preprocessed-combined.irtg
```

Note that this produces a synchronous probabilistic context-free grammar with rules like this:

```bash
S! -> r1792(NP_animate_nsubj, VP_external) 	[0.49]
  [english] *(?1, ?2)
  [semantics] pre_agent(?2, ?1)
```

For the generation step, we only need the *English* part of the grammar -- the *Semantics* will be used in order to parse the generated sentences later on.

So, we use `irtg2ebnf.py` to simply convert the IRTG format into the English-only rules which will be part of the prompt later on.
